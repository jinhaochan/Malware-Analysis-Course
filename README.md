# Malware-Analysis-Course
Stuff from udemy

## Structure of an Office file


### 1. OLE Compound File

OLE (Object Linking and Embedding) is the older representation of office objects (`.doc`, `.ppt`, `.xls`)

Magic number `D0 CF 11 E0 A1 B1 1A E1`

OLE is a collection of Storages and Stream. Storages stores other storages more stream, and the leaf of any OLE tree is always a stream

![image](https://user-images.githubusercontent.com/7328587/121039925-155fc180-c7e4-11eb-9800-e3f8dd7cafb3.png)

The text data is stored in `WordDocument`

The macros are stored in `Marcos`

### 2. OOXML

OOXML (Office Open XML) is the newer representation of office objects (`.docx`, `.pptx`, `.xlsx`)

It is simply a zip file, and you can open it by replacing the file extension with `.zip`

## `oledump`

We can use `oledump.py` on office documents to identify any hidden macros that will be executed.

Running the initial `oledump.py` on a file separate the office objects.

![image](https://user-images.githubusercontent.com/7328587/121040450-7d160c80-c7e4-11eb-8fc9-016cebfb665c.png)

`oledump.py <file>`

The line marked with the letter `M` indicates that a macro is present. To look at its contents, we pass the section number (7), and tell oledump to do a VB decompression

`oledump.py <file> -s 7 -v`

![image](https://user-images.githubusercontent.com/7328587/121040827-cd8d6a00-c7e4-11eb-9746-15057c30211a.png)

Looking at the marco, it tries to run a powershell command to spawn a command line, download a malicious file `NDGAFV.exe` and rename it as `playa.exe`. Then it tries to run the binary before exiting the shell.

## `oletools`

Similar to `oledump`, `oletools` analyzes OLE objects

![image](https://user-images.githubusercontent.com/7328587/121042062-e64a4f80-c7e5-11eb-8604-f96b958086b6.png)

Here we see a table that is generated that tells us general information about the object.

Under VBA Macros, it's a `True` which tells use that macros are in the file, and we should investigate that.

## `olemeta`

`olemeta` gives you metadata overview of the file, and it can be helpful too.

![image](https://user-images.githubusercontent.com/7328587/121042511-58229900-c7e6-11eb-9920-f8effa76cb83.png)

In one such table, we see that it has 1 page, but zero words and zero characters. This should raise levels of suspicion about the file.

## `oledir`

`oledir` gives you the directory representation of an object

![image](https://user-images.githubusercontent.com/7328587/121042917-bbacc680-c7e6-11eb-81cd-02896ee01baf.png)

## `olevba`

`olevba` extracts the VBA script inside of the OLE object

![image](https://user-images.githubusercontent.com/7328587/121043301-10e8d800-c7e7-11eb-8a18-5562b3463521.png)

This tool gives you a brief description of what the macro is doing in the based on the function calls.

It also gives you the IOCs that are interesting.





